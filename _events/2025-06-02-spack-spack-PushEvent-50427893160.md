---
event_type: PushEvent
avatar: "https://avatars.githubusercontent.com/u/299842?"
user: tgamblin
date: 2025-06-02
repo_name: spack/spack
html_url: https://github.com/spack/spack/commit/7431f033cbb4febfa0ab5992448d69a3e9c79dc9
repo_url: https://github.com/spack/spack
---

<a href='https://github.com/tgamblin' target='_blank'>tgamblin</a> pushed to <a href='https://github.com/spack/spack' target='_blank'>spack/spack</a>

<small>Remove Python 2 specific code (#50746)

* Refactor OSError handling in filesystem.py for Python 3

I changed `e.winerror` to `e.errno` in `lib/spack/llnl/util/filesystem.py`
for Python 3 compatibility. This change specifically addresses an
OSError handling block for Windows where `e.winerror == 5` (ACCESS_DENIED)
was checked. The code now uses `e.errno == errno.EACCES` which is the
standard way to check for this error in Python 3, while preserving the
Windows-specific logic.

I ran the existing tests, and they passed, confirming no regressions were
introduced by this change.

* Refactor OSError handling in filesystem.py for Python 3 (round 2)

I simplified a Windows-specific OSError handling case in
`lib/spack/llnl/util/filesystem.py` during symlink creation.
The check for `e.winerror == 183` (Windows-specific "file exists")
was removed in favor of the standard `e.errno == errno.EEXIST`,
as Python 3 correctly maps this error code on Windows.

This change further removes Python 2 era checks and relies on
Python 3's improved error handling consistency across platforms.

I ran the existing tests and they passed, confirming no regressions were
introduced by this change.

* Refactor loop in traverse.py to use `yield from`

I replaced a `for item in iterable: yield item` loop with the
more idiomatic `yield from iterable` in the
`traverse_breadth_first_tree_edges` function within
`lib/spack/spack/traverse.py`.

This is a standard Python 3.3+ improvement for delegating to
a sub-generator. Spack's minimum Python version is 3.6, making
this change appropriate and safe. I also updated the associated comment.

* I've removed some unnecessary comments from the code.

Specifically, I took out the recently added explanatory comments in:
- lib/spack/spack/test/llnl/util/lock.py (regarding Barrier exceptions)
- lib/spack/spack/traverse.py (regarding `yield from` introduction)

You indicated these comments weren't needed. The underlying code functionality, which was refactored previously, remains unchanged.

* Remove useless statement

* [@spackbot] updating style on behalf of haampie

---------

Co-authored-by: google-labs-jules[bot] <161369871+google-labs-jules[bot]@users.noreply.github.com>
Co-authored-by: haampie <haampie@users.noreply.github.com></small>

<a href='https://github.com/spack/spack/commit/7431f033cbb4febfa0ab5992448d69a3e9c79dc9' target='_blank'>View Commit</a>