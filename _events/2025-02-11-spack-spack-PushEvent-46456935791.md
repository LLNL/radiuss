---
event_type: PushEvent
avatar: "https://avatars.githubusercontent.com/u/194764?"
user: haampie
date: 2025-02-11
repo_name: spack/spack
html_url: https://github.com/spack/spack/commit/ae3bcf9937eddaf924f634d8c39fcfeae7c60da2
repo_url: https://github.com/spack/spack
---

<a href='https://github.com/haampie' target='_blank'>haampie</a> pushed to <a href='https://github.com/spack/spack' target='_blank'>spack/spack</a>

<small>Spec.satisfies, Spec.intersects: drop spack.repo

Currently Spec.satisfies is stateful both for concrete and abstract
specs, even after our changes where concrete specs list virtuals as edge
attributes.

Virtuals on edges basically provide too little information:

1. They don't specify what version of the virtual is provided, so you
   cannot know the return value of `s.satisfies("^mpi@3:")` without
   looking in the current state of the package.
2. It's not all about edges: `mpich.satisfies("mpi")` is expected to be
   true (difference is *can* provide versus *provides*).

This commit tries to reduce the statefulness by only letting satisfies
and intersects access `spec.package`, instead of looking up the package.
The idea is that it reduces the surface area with `spack.repo`, as in
principle `spec.package` can be set upon construction.

The commit is breaking for abstract specs. The idea is you cannot answer
queries about abstract specs unless you associate a repo.</small>

<a href='https://github.com/spack/spack/commit/ae3bcf9937eddaf924f634d8c39fcfeae7c60da2' target='_blank'>View Commit</a>